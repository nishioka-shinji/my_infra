apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: digger
  namespace: digger
spec:
  interval: 30m
  chart:
    spec:
      chart: digger-backend
      version: "0.1.12"
      sourceRef:
        kind: HelmRepository
        name: digger
  values:
    digger:
      image:
        repository: registry.digger.dev/diggerhq/digger_backend
        tag: "v0.6.126"
      nodeSelector:
        cloud.google.com/gke-spot: "true"
      resources:
        requests:
          cpu: 250m
          memory: 500Mi
        limits:
          cpu: 250m
          memory: 500Mi
      ingress:
        enabled: false
      secret:
        useExistingSecret: true
        existingSecretName: digger-digger-backend-secret
      extraEnv:
      - name: PGHOST
        value: digger-cluster.digger.svc.cluster.local
      - name: PGDATABASE
        value: digger
      - name: PGUSER
        value: digger
      - name: PGPASSWORD
        valueFrom:
          secretKeyRef:
            name: digger.digger-cluster.credentials.postgresql.acid.zalan.do
            key: password
      - name: PGSSLMODE
        value: disable
