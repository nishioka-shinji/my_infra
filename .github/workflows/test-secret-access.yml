name: Test Secret Access

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  test-access:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v2
        with:
          workload_identity_provider: 'projects/513283484243/locations/global/workloadIdentityPools/github-pool/providers/nishioka-shinji-prvdr'
          project_id: 'shinji-nishioka-test'
          # No service_account specified to test direct federation or if a default is assumed, 
          # but based on the request "test if *this account* can get secrets", we rely on the attributes 
          # mapped to the principalSet/principal.

      - name: Access Secret
        run: |
          gcloud secrets versions access latest --secret="Jules_Api_Key" > /dev/null
